<ion-card *ngIf="event" class="event">
	<ion-card-content class="statusNote" [style.background-color]="event.status | eventStatus: 'color'">
		<p>
			<strong>{{ event.status | eventStatus: "name" }}</strong
			><ng-container *ngIf="event.statusNote">: {{ event.statusNote }}</ng-container>
		</p>
	</ion-card-content>

	<ion-item *ngIf="open" lines="none" [detail]="true" [routerLink]="'/akce/' + event.id" class="mt-3 event-heading">
		<ng-container *ngTemplateOutlet="itemContent"></ng-container>
	</ion-item>

	<ion-item *ngIf="!open" lines="none" class="mt-3 event-heading">
		<ng-container *ngTemplateOutlet="itemContent"></ng-container>
	</ion-item>

	<ng-template #itemContent>
		<div
			slot="start"
			class="icon"
			[style.background-color]="(event | event: 'image') ? 'transparent' : (event | event: 'color') || '#ccc'"
		>
			<img *ngIf="event | event: 'image'" class="img-fluid" [src]="event | event: 'image'" />
		</div>

		<ion-label>
			<h3>{{ event.name }}</h3>
			<p>
				<ng-container *ngIf="event?.dateFrom">{{ [event.dateFrom, event.dateTill] | dateRange }}</ng-container>
				<ng-container *ngIf="event?.dateFrom && event?.place">, </ng-container>
				<ng-container *ngIf="event?.place">{{ event.place }}</ng-container>
			</p>
		</ion-label>
	</ng-template>

	<ion-card-content>
		<p *ngIf="event?.description" class="description mb-3">{{ event.description }}</p>

		<p *ngIf="event.meetingPlaceStart || event.meetingPlaceEnd" class="mb-3">
			<ng-container *ngIf="event.meetingPlaceStart"
				><strong>Sraz: </strong>{{ event.meetingPlaceStart }}</ng-container
			>
			<ng-container *ngIf="event.meetingPlaceStart && event.meetingPlaceEnd">, </ng-container>
			<ng-container *ngIf="event.meetingPlaceEnd"
				><strong>Konec: </strong>{{ event.meetingPlaceEnd }}</ng-container
			>
		</p>
		<p class="mb-0">
			Vede <strong [innerHTML]="event.leaders?.length ? (event.leaders! | joinLeaders) : 'pan NIKDO'"></strong>
		</p>
	</ion-card-content>

	<ion-card-content *ngIf="actions" class="text-right buttons">
		<ion-buttons class="d-block">
			<ion-button
				*ngIf="event._links.submitEvent.applicable"
				color="primary"
				[disabled]="!event._links.submitEvent.allowed"
				(click)="eventAction(event, 'submitEvent')"
			>
				Ke schválení
			</ion-button>

			<ion-button
				*ngIf="event._links.rejectEvent.applicable"
				[disabled]="!event._links!.rejectEvent.allowed"
				(click)="eventAction(event, 'rejectEvent')"
			>
				K úpravám
			</ion-button>

			<ion-button
				*ngIf="event._links.publishEvent.applicable"
				color="primary"
				[disabled]="!event._links!.publishEvent.allowed"
				(click)="eventAction(event, 'publishEvent')"
			>
				Do programu
			</ion-button>

			<ion-button
				*ngIf="event._links.unpublishEvent.applicable"
				[disabled]="!event._links!.unpublishEvent.allowed"
				(click)="eventAction(event, 'unpublishEvent')"
			>
				Z programu
			</ion-button>

			<ion-button
				*ngIf="event._links.cancelEvent.applicable"
				color="danger"
				[disabled]="!event._links!.cancelEvent.allowed"
				(click)="eventAction(event, 'cancelEvent')"
			>
				Zrušit akci
			</ion-button>

			<ion-button
				*ngIf="event._links.uncancelEvent.applicable"
				[disabled]="!event._links!.uncancelEvent.allowed"
				(click)="eventAction(event, 'uncancelEvent')"
			>
				Vrátit zrušení
			</ion-button>
		</ion-buttons>
	</ion-card-content>
</ion-card>
